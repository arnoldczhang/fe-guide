# 方法论建设

> 你要学会把代码和你自己分离，不要成为代码的拥有者。你要优化代码，便于其他人找到方法来修复错误和添加功能，把代码的控制权分散。因为你需要解放自己，继续去做下一个项目，否则你将永远无法脱身。

[TOC]



## 参考

- [软件高可用实践](https://mp.weixin.qq.com/s?__biz=MzU1MzE2NzIzMg==&mid=2247491846&idx=1&sn=0265f92779f61142af1f787b306f4900&scene=21#wechat_redirect)

---

## 前端架构
> 强观点，弱立场
>
> 首先凭直觉得出一个“结论”，之后根据反面信息，不断修正之前的结论

[前端架构设计的方法论](https://segmentfault.com/a/1190000016873522?utm_source=tag-newest)

系统的架构设计用来定义应用程序的基本特征和行为。
良好的架构是系统构建成功的关键。
架构驱动的软件开发是构建复杂系统的最有效方法，架构驱动的方法优于需求驱动，文档驱动和方法论（抽象推理的能力）驱动。虽然方法论（抽象推理的能力）可以帮助我们取得项目的成功，但是它并不是决定性的因素。

### 1、初期如何设计架构
所有架构的核心：关注点分离（分离角色和职能，分离之后的结果是对具体功能的高度抽象）。

架构设计的过程其实也是在梳理需求的过程中不断标识、封装和操纵关注点。
根据迪米特法则和开闭原则，分离之后的职责对象应该高度独立和封闭（优点是不需要关系它们内部的具体实现，只关心输入和输出即可）。

更容易构造有效的(职责)角色和强力的模型，变的更好开发，测试，管理和维护。

### 2、构建系统的步骤
- 抽象职责（功能模块）之间的相互作用
- 抽象职责和数据流之间的关系

### 3、注意的四个点
- 扩展性
- 弹性（伸缩性）
- 灵活性
- 稳定性

### 4、评判标准
- 灵活性
响应外部环境变化的能力，架构中是否便捷做一些改变，功能模块间的紧耦合是降低灵活性的关键。
- 易于部署
- 易于开发
- 可测试性
职责和数据流的划分，便于分块测试。
- 伸缩性
系统是否利于扩展，紧耦合与职责划分不清晰是降低伸缩性的关键。
- 性能
任何架构的本质是在处理数据流，所以数据流的流转效率决定了该架构的性能。

## 最后
本文提出的这些观点实际上也是属于架构设计的方法论。在掌握并熟练运用了这些方法论之后并实践到项目中，慢慢的才会搭建出更好的架构。

---

## 沙箱sandbox

- [从 0 到 1 实现浏览器端沙盒运行环境](https://mp.weixin.qq.com/s/7CD_F0hEZtYRK0fvBWb_gQ)
- [实现前端沙箱](https://mp.weixin.qq.com/s?__biz=Mzk0MDMwMzQyOA==&mid=2247493311&idx=1&sn=701ca8e88f02a028d653431a2d752a37&scene=21#wechat_redirect)

**Step1. 加载依赖**

加载 Babel, React, ReactDOM

**Step2. 转译模块**

利用 Babel 将 ESM 转 CommonJS，转 JSX 语法

**Step3. 执行代码**

构造 CommonJS 环境，如 require 加载模块函数

### 几种沙箱方式

**单例沙箱**

> 仍基于 window 做代理，应用卸载清理绑定的全局变量
> 性能较高

**多例沙箱**

> 复制一份 fakeWindow（遍历window属性）

**node-vm**

```js
"use strict";
const vm = require("vm");
const xyz = vm.runInNewContext(`let a = "welcome!";a;`);
console.log(xyz); // a
```

**node-vm2**

> 社区版本 vm，基于 Proxy，相对安全性较高
