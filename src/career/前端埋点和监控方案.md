# 前端埋点和监控方案

## 参考
- [单页应用优雅的上报前端性能数据](https://github.com/forthealllight/blog/issues/38)

## 监听url
```js
var _wr = function(type) {
   var orig = history[type];
   return function() {
       var rv = orig.apply(this, arguments);
      var e = new Event(type);
       e.arguments = arguments;
       window.dispatchEvent(e);
       return rv;
   };
};
 history.pushState = _wr('pushState');
 history.replaceState = _wr('replaceState');
```

## 上报方式
- <img />
- navigator.sendBeacon(url [, data]);
- ajax post

## 采集

对于跨域资源
``html
<!-- 添加crossorigin -->
<!-- 当然服务端也要返回：Access-Control-Allow-Origin: * -->
<!-- 兼容性：ie9+、safari8+ -->
<script crossorigin src="..."></script>
```

```js
// hack原生方法
const prevSetTimeout = window.setTimeout;

window.setTimeout = function(callback, timeout) {
  const self = this;
  return prevSetTimeout(function() {
    try {
      callback.call(this);
    } catch (e) {
      // 捕获到详细的错误，在这里处理日志上报等了逻辑
      // ...
      throw e;
    }
  }, timeout);
} 
```

## 数据处理

## 分析

## 报警




