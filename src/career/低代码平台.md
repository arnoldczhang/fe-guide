# 低代码平台

## 背景

- **越来越多的业务需求与有限人力资源的矛盾**：
  
  - 市面上的低代码引擎只做到了页面视图的搭建，难以满足复杂多变的业务需求
  
  - 缺少多功能多场景的企业级低代码平台降低开发门槛、赋能更多人来提升综合效率

- **现有各种物料、服务相互独立，使用&链接成本高，数据孤岛问题突出**：
  
  - 通过具体业务的实践，打磨完善schema-component渲染引擎，沉淀了大量通用的基础组件、业务组件，能满足大部分复杂的B端场景，但是直接使用引擎学习门槛非常高，需要一个可视化的平台来降低用户使用门槛
  
  - 现有的审批、权限管理、人员信息、数据统计等公司级平台服务的认知和对接成本偏高，需要一个综合平台抹平底层的对接差异



## 目标

- **支持一站式开发**：用户能在平台上完成应用的全生命周期（包括存储、建模、页面搭建、调试预览、页面渲染、多环境发布、监控&数据统计等）管理

- **可扩展性**：平台负责对接各种服务，可持续迭代升级，以应对较多复杂场景

- **多环境一致性**：平台一处配置，标准流程发布后多环境配置数据无感同步



## 系统架构

- 引擎（底层领域模型 + 主题渲染）

- platform（配置平台）

- loader（通用加载器）

- app-preview（页面通用渲染器）



## 项目

### 移动端

- schema

- engine

- 移动端theme



### BI



### AI问数

#### 业界方案

- [nl2sql - vanna](https://github.com/vanna-ai/vanna)

#### 常见模型

问题：基于用户的提示（比如生成一个物流管理系统），创建对于的、所需要用到的模型：

| AI            | 速度   | 聪明程度(10分满分) | 稳定性 |
| ------------- | ---- | ----------- | --- |
| qwen turbo    | 28s  | 4           | 一般  |
| qwen max      | 68s  | 7           | 好   |
| qwen plus     | 20s  | 9           | 很好  |
| coze          | 26s  | 3           | 好   |
| kimi          | 48s  | 7           | 好   |
| 文心一言3.5       | 250s | 7           | 很差  |
| 文心一言4.0 turbo | 300s | 5           | 很差  |
| gpt4 turbo    | 54s  | 7-8         | 一般  |
| gpt3.5        | 70s  | 6           | 一般  |
| deepseek      | 30s  | 9           | 很好  |

#### 整体方案

- 业务侧：初始化chatUI
- 前端框架：chatUI
- 服务端：几个接口
- 底层：chatsdk



#### 技术难点

- 协议

- lazy load

- prompt + json schema



##### 协议

**消息、会话**

```ts
type MessageType = 'text' | 'image' | 'file' | 'custom'

interface IChatUser {
    id: string;
    name: string;
    avatar: string;
}

interface IAttachment {
    id: string;
    name: string;
    type: 'image' | 'file' | 'video';
    url: string;
}

interface IMessageAction {
    id: string;
    name: string;
    icon: string;
    handler: () => void;
}

interface IChatMessage {
    id: string;
    sender: IChatUser;
    content: string;
    mesageType: MessageType;
    createdAt: number;
    updatedAt: number;
    attachments: IAttachment[];
    actions: IMessageAction[];
    status: 'sending' | 'sent' | 'failed';
}

type ConversationType = 'single' | 'group'; // 单聊群聊

interface IChatConversation {
    id: string;
    name: string;
    avatar?: string;
    type: ConversationType;
    participants?: IChatUser[];
    latestMessage: IChatMessage;
    unreadCount?: number;
    isPinned?: boolean;
    isMuted?: boolean;
    createdAt: number;
    updatedAt: number;
}
```



**通信**

```ts
// 公共结构
interface ICommon {
    type: 'text' | 'markdown' | 'divider' | 'br';
    content: string;
}

interface IFormStart{
    type: 'formStart';
}

interface IFormEnd{
    type: 'formEnd';
}

interface Image {
    type: 'image';
    url: string;
    desc?: string;
    width?: number;
}


interface IButton {
    type: 'button';
    conent: {
        text: string;
        type: 'primary' | 'secondary' | '...';
        size: 'large' | '...';
        icon: string;
        disabled: boolean;
        hoverTip:{
            content: string;    
        };
        // 二次确认
        confirm: {
            title: string;
            content: string;
            behaviors: [{
                type: 'open_url' | 'callback' | 'action_call';
                payload: {};
            }];
        };
    };
}
```



##### prompt + json schema

- 事前
  
  - prompt优化（[prompt优化器](https://github.com/linshenkx/prompt-optimizer)）
  
  - tools（function call）

- 事中
  
  - 输入token优化（ json转markdown表格）

- 事后
  
  - ai返回结构补全